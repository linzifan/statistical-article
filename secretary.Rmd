---
title: "Secretary Problem"
author: "Zifan Lin"
date: "March 2, 2015"
output: html_document
---
### Introduction
The **secretary problem** is one of many names for a famous problem of the optimal stopping theory. It is also known as the marriage problem, the sultan's dowry problem, the fussy suitor problem, the googol game, and the best choice problem.

In this article, I will both introduce theoretical prove and statistical simulation in `R`.

### Description

Imagine an administrator is willing to hire the best secretary out of $n$ rankable applicants. The applicants are interviewed one by one in a random order. A decision about each particular applicant is to be made immediately after the interview. Once rejected, an applicant cannot be recalled. During the interview, the dadministrator can rank the applicants among all applicants interviewed so far, but is unaware of the quality of yet unseen applicants. **The question is to maximize the probability of selecting the best applicant.**

This problem can also be described as follows: suppose number $1, 2, ..., n$ are ordered randomly. Your goal is to choose the maximum number $n$. You will see each number one by one. At each round, you can choose whether keep the number to finish or pass the number to see the next one. What strategy will you have to maximize the probability of having number $n$ finally?


### Solution
The administrator will first interview $k$ applicants, and reject all of them, but record the best among them as the benchmark. Starting from the $k+1^{th}$ applicant, the administrator will accept the first applicant who is better than the benchmark (or continue to the last applicant if it never occurs).

Now let's determine the value of $k$.

Let $X$ be a random variable describing the place where the maximun number $n$ is. $X$ can be any number in $\{1,2, ...\}$ with equal probability $1/n$.

$$Pr(best) = \sum_{i=1}^n Pr(best|X=i)Pr(X=i)$$

- If $i\leq k$, $Pr(best|X=i)=0$

- If $i > k$, the best among $i-1$ should be in the first $k$, $Pr(best|X=i)=\frac{k}{i-1}$

Therefore,

$$Pr(best) = \frac{k}{n}\sum_{i=k+1}^n \frac{1}{i-1} \approx \frac{k}{n} \int_{k}^{n-1} \frac{1}{x} dx
 = \frac{k}{n} \ln \frac{n-1}{k} \approx \frac{k}{n} \ln \frac{n}{k}$$
 
Consider the function 
 
$$g(k) = \frac{k}{n} \ln \frac{n}{k}$$
$$g'(k) = \frac{1}{n} \ln \frac{n}{k} + \frac{k}{n} \frac{1}{\frac{n}{k}} \left(- \frac{n}{k^2} \right)
 = \frac{1}{n} \ln \frac{n}{k} - \frac{1}{n} = 0$$
$$k = \frac{n}{e}$$
 
The probability is maximized at $\frac{1}{e} \approx 0.3679$ when $k = \frac{n}{e}$.
 
### Simulation
 
```{r}
n <- 100
# simulate 10000 times
final.choice <- rep(NA, 10000)

for (j in 1:10000){
  sample.order <- sample(1:n, n, replace = FALSE)
  k <- ceiling(n/exp(1))
  best.so.far <- max(sample.order[1:k])
  i <- k + 1
  while (TRUE){
    if (sample.order[i] > best.so.far) {final.choice[j] <- sample.order[i]
                                        break}
    i <- i + 1
    if (i > n) {final.choice[j] <- sample.order[n]
                break}
  }
}
# The probability that we choose the best applicant
sum(final.choice==n)/10000
# Let's see the convergence of the probability
prob <- rep(NA, 10000)
for (j in 1:10000){
  prob[j] <- sum(final.choice[1:j]==n)/j
}
plot(prob, xlab="# of simulations", type="l", ylim=c(0,1))
```


### Further Research

If we give each secretary a score representing her ability, and assume the score distribution, we could develope a strategy that maximize the expected score of final choice. It is natural, since the interviewer would rather hire a higher-valued applicant than a lower-valued one, and not only be concerned with getting the best.

Suppose the value for each secretary is iid from uniform distribution. The strategy is the same as above, but we may choose another threshold $k$. According to [Bearden 2006](http://ac.els-cdn.com/S0022249605000933/1-s2.0-S0022249605000933-main.pdf?_tid=b89b5e98-c130-11e4-8320-00000aab0f26&acdnat=1425337753_98db6d1df555461afadbd7023f17c55f), $k$ is the integer cloest to $\sqrt{n}$.

```{r}
n <- 100
# simulate 10000 times
final.choice1 <- rep(NA, 10000)
final.choice2 <- rep(NA, 10000)
isbest1 <- 0
isbest2 <- 0
for (j in 1:10000){
  secretary <- runif(n)
  best.secretary <- max(secretary)
  sample.order <- sample(secretary, n, replace = FALSE)
  
  k1 <- ceiling(n/exp(1))
  best.so.far1 <- max(sample.order[1:k1])
  i <- k1 + 1
  while (TRUE){
    if (sample.order[i] > best.so.far1) {final.choice1[j] <- sample.order[i]
                                        break}
    i <- i + 1
    if (i > n) {final.choice1[j] <- sample.order[n]
                break}
  }
  if (final.choice1[j]==best.secretary) isbest1 <- isbest1 + 1
  
  k2 <- ceiling(sqrt(n))
  best.so.far2 <- max(sample.order[1:k2])
  i <- k2 + 1
  while (TRUE){
    if (sample.order[i] > best.so.far2) {final.choice2[j] <- sample.order[i]
                                         break}
    i <- i + 1
    if (i > n) {final.choice2[j] <- sample.order[n]
                break}
  }
  if (final.choice2[j]==best.secretary) isbest2 <- isbest2 + 1
}
# The probability of choosing the best
isbest1/10000
isbest2/10000
# The expected score for two threshold
sum(final.choice1)/10000
sum(final.choice2)/10000
```

We can see that the modified strategy has lower probability of choosing the best, but will have high expected score of final choice.
